<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Binding_tree (beluga.Syncom.Binding_tree)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">beluga</a> &#x00BB; <a href="../index.html">Syncom</a> &#x00BB; Binding_tree</nav><header class="odoc-preamble"><h1>Module <code><span>Syncom.Binding_tree</span></code></h1><p>Mutable map data structure from namespaced identifiers to values.</p><p>A binding tree is a tree of identifiers mapped to values, like in a map data structure. Entries in a binding tree are toplevel if they are direct children of the tree root (i.e., they are not entries nested in namespaces). Identifiers may be used as keys for toplevel entries in the tree, and qualified identifiers may be used as keys for all entries in the tree (toplevel or nested in namespaces). Hence, a lookup in a binding tree traverses the tree from the root to an internal node or leaf by sequentially traversing the list of identifier segments in the qualified identifier.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec exception anchored" id="exception-Unbound_identifier"><a href="#exception-Unbound_identifier" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Unbound_identifier</span> <span class="keyword">of</span> <a href="../Identifier/index.html#type-t">Identifier.t</a></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Unbound_qualified_identifier"><a href="#exception-Unbound_qualified_identifier" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Unbound_qualified_identifier</span> <span class="keyword">of</span> <a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Unbound_namespace"><a href="#exception-Unbound_namespace" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Unbound_namespace</span> <span class="keyword">of</span> <a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>The type of binding trees.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_empty"><a href="#val-is_empty" class="anchor"></a><code><span><span class="keyword">val</span> is_empty : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Bool.t</span></code></div><div class="spec-doc"><p><code>is_empty tree</code> is <code>true</code> if and only if there are no bindings in <code>tree</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_toplevel"><a href="#val-add_toplevel" class="anchor"></a><code><span><span class="keyword">val</span> add_toplevel : <span><a href="../Identifier/index.html#type-t">Identifier.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?subtree</span>:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Unit.t</span></code></div><div class="spec-doc"><p><code>add_toplevel identifier value ?subtree tree</code> adds <code>(value, subtree)</code> bound for <code>identifier</code> in <code>tree</code>, where <code>subtree</code> defaults to <code>empty</code>. This shadows any previous bindings for <code>identifier</code> in <code>tree</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add"><a href="#val-add" class="anchor"></a><code><span><span class="keyword">val</span> add : 
  <span><a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?subtree</span>:<span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Stdlib</span>.Unit.t</span></code></div><div class="spec-doc"><p><code>add identifier entry ?subtree tree</code> adds <code>entry</code> and <code>subtree</code> bound to <code>identifier</code> in <code>tree</code>. The namespaces of <code>identifier</code> must be bound in <code>tree</code>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_namespace"><code>Unbound_namespace</code></a> </li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-add_all"><a href="#val-add_all" class="anchor"></a><code><span><span class="keyword">val</span> add_all : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Unit.t</span></code></div><div class="spec-doc"><p><code>add_all t1 t2</code> adds all the bindings from <code>t2</code> to <code>t1</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span><span class="keyword">val</span> remove : <span><a href="../Identifier/index.html#type-t">Identifier.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Unit.t</span></code></div><div class="spec-doc"><p><code>remove identifier tree</code> removes the binding in <code>tree</code> for <code>identifier</code>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_identifier"><code>Unbound_identifier</code></a> </li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup_toplevel"><a href="#val-lookup_toplevel" class="anchor"></a><code><span><span class="keyword">val</span> lookup_toplevel : <span><a href="../Identifier/index.html#type-t">Identifier.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> * <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>lookup_toplevel identifier tree</code> is <code>(value, subtree)</code> where <code>value</code> and <code>subtree</code> are as added with <a href="#val-add"><code>add</code></a>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_identifier"><code>Unbound_identifier</code></a> </li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup_toplevel_opt"><a href="#val-lookup_toplevel_opt" class="anchor"></a><code><span><span class="keyword">val</span> lookup_toplevel_opt : <span><a href="../Identifier/index.html#type-t">Identifier.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>)</span> <a href="../../Support/Option/index.html#type-t">Support.Option.t</a></span></span></code></div><div class="spec-doc"><p><code>lookup_toplevel_opt identifier tree</code> is <code>Option.Some (value, subtree)</code> where <code>value</code> and <code>subtree</code> are as added with <a href="#val-add"><code>add</code></a>, and <code>Option.None</code> if there is no binding in <code>tree</code> for <code>identifier</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-lookup"><a href="#val-lookup" class="anchor"></a><code><span><span class="keyword">val</span> lookup : <span><a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> * <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>lookup qualified_identifier tree</code> is <code>(value, subtree)</code> where <code>value</code> and <code>subtree</code> are as added with <a href="#val-add"><code>add</code></a>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_identifier"><code>Unbound_identifier</code></a> </li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_qualified_identifier"><code>Unbound_qualified_identifier</code></a> </li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_namespace"><code>Unbound_namespace</code></a> </li></ul></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-maximum_lookup_result"><a href="#type-maximum_lookup_result" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a maximum_lookup_result</span></span><span> = </span></code><ol><li id="type-maximum_lookup_result.Unbound" class="def variant constructor anchored"><a href="#type-maximum_lookup_result.Unbound" class="anchor"></a><code><span>| </span><span><span class="constructor">Unbound</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-maximum_lookup_result.segments" class="def record field anchored"><a href="#type-maximum_lookup_result.segments" class="anchor"></a><code><span>segments : <span><a href="../Identifier/index.html#type-t">Identifier.t</a> <a href="../../Support/List1/index.html#type-t">Support.List1.t</a></span>;</span></code></li></ol><code><span>}</span></code></li><li id="type-maximum_lookup_result.Partially_bound" class="def variant constructor anchored"><a href="#type-maximum_lookup_result.Partially_bound" class="anchor"></a><code><span>| </span><span><span class="constructor">Partially_bound</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-maximum_lookup_result.leading_segments" class="def record field anchored"><a href="#type-maximum_lookup_result.leading_segments" class="anchor"></a><code><span>leading_segments : <span><a href="../Identifier/index.html#type-t">Identifier.t</a> <a href="../../Support/List/index.html#type-t">Support.List.t</a></span>;</span></code></li><li id="type-maximum_lookup_result.segment" class="def record field anchored"><a href="#type-maximum_lookup_result.segment" class="anchor"></a><code><span>segment : <a href="../Identifier/index.html#type-t">Identifier.t</a>;</span></code></li><li id="type-maximum_lookup_result.trailing_segments" class="def record field anchored"><a href="#type-maximum_lookup_result.trailing_segments" class="anchor"></a><code><span>trailing_segments : <span><a href="../Identifier/index.html#type-t">Identifier.t</a> <a href="../../Support/List1/index.html#type-t">Support.List1.t</a></span>;</span></code></li><li id="type-maximum_lookup_result.entry" class="def record field anchored"><a href="#type-maximum_lookup_result.entry" class="anchor"></a><code><span>entry : <span class="type-var">'a</span>;</span></code></li><li id="type-maximum_lookup_result.subtree" class="def record field anchored"><a href="#type-maximum_lookup_result.subtree" class="anchor"></a><code><span>subtree : <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>;</span></code></li></ol><code><span>}</span></code></li><li id="type-maximum_lookup_result.Bound" class="def variant constructor anchored"><a href="#type-maximum_lookup_result.Bound" class="anchor"></a><code><span>| </span><span><span class="constructor">Bound</span> <span class="keyword">of</span> </span><span>{</span></code><ol><li id="type-maximum_lookup_result.entry" class="def record field anchored"><a href="#type-maximum_lookup_result.entry" class="anchor"></a><code><span>entry : <span class="type-var">'a</span>;</span></code></li><li id="type-maximum_lookup_result.subtree" class="def record field anchored"><a href="#type-maximum_lookup_result.subtree" class="anchor"></a><code><span>subtree : <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>;</span></code></li></ol><code><span>}</span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-maximum_lookup"><a href="#val-maximum_lookup" class="anchor"></a><code><span><span class="keyword">val</span> maximum_lookup : 
  <span><span><a href="../Identifier/index.html#type-t">Identifier.t</a> <a href="../../Support/List1/index.html#type-t">Support.List1.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-maximum_lookup_result">maximum_lookup_result</a></span></span></code></div><div class="spec-doc"><p><code>maximum_lookup identifiers tree</code> looks up as many bound identifiers in <code>identifiers</code> as possible against <code>tree</code> in sequence. This effectively matches <code>identifiers</code> as a path in <code>tree</code>.</p><p><code>maximum_lookup identifiers tree</code> is one of three outcomes, in increasing length of matching path:</p><ol><li><code>`Unbound identifiers</code> if the first identifier in <code>identifiers</code> is not bound in <code>tree</code>, so <code>identifiers</code> is not a path in <code>tree</code>.</li><li><code>`Partially_bound (bound, (entry, subtree), unbound_identifiers)</code> if not all identifiers in <code>identifiers</code> are bound in <code>tree</code>, so first few identifiers form a path in <code>tree</code>.</li><li><code>`Bound (entry, subtree)</code> if all identifiers in <code>identifiers</code> are bound, so they form a path in <code>tree</code>.</li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-open_namespace"><a href="#val-open_namespace" class="anchor"></a><code><span><span class="keyword">val</span> open_namespace : <span><a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Unit.t</span></code></div><div class="spec-doc"><p><code>open_namespace qualified_identifier tree</code> adds all the bindings from <code>subtree</code> to <code>tree</code> if <code>lookup qualified_identifier tree = (_value, subtree)</code>.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_identifier"><code>Unbound_identifier</code></a> </li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_qualified_identifier"><code>Unbound_qualified_identifier</code></a> </li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <a href="#exception-Unbound_namespace"><code>Unbound_namespace</code></a> </li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_identifier_bound"><a href="#val-is_identifier_bound" class="anchor"></a><code><span><span class="keyword">val</span> is_identifier_bound : <span><a href="../Identifier/index.html#type-t">Identifier.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Bool.t</span></code></div><div class="spec-doc"><p><code>is_identifier_bound identifier tree</code> is <code>true</code> if and only if there is a binding for <code>identifier</code> in <code>tree</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_qualified_identifier_bound"><a href="#val-is_qualified_identifier_bound" class="anchor"></a><code><span><span class="keyword">val</span> is_qualified_identifier_bound : 
  <span><a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Stdlib</span>.Bool.t</span></code></div><div class="spec-doc"><p><code>is_qualified_identifier_bound identifier tree</code> is <code>true</code> if and only if there is a binding for <code>identifier</code> in <code>tree</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-replace"><a href="#val-replace" class="anchor"></a><code><span><span class="keyword">val</span> replace : 
  <span><a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> * <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span class="xref-unresolved">Stdlib</span>.Unit.t</span></code></div><div class="spec-doc"><p><code>replace identifier f tree</code> replaces the value bound at <code>identifier</code> in <code>tree</code> with <code>f entry subtree</code>, with <code>(entry, subtree)</code> being the result of <code>lookup identifier tree</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span><span class="keyword">val</span> mem : <span><a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Bool.t</span></code></div><div class="spec-doc"><p><code>mem identifier tree</code> is <code>true</code> if and only if there is a binding in <code>tree</code> for <code>identifier</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-snapshot"><a href="#val-snapshot" class="anchor"></a><code><span><span class="keyword">val</span> snapshot : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>snapshot tree</code> is a duplicate of <code>tree</code> that only retains the latest bindings. The values are kept as is. Snapshots of the subtrees in <code>tree</code> are also taken. A snapshot is not a deep copy precisely because the old bindings in the hashtables are not carried over.</p><p>A snapshot of a binding tree is essentially a frozen duplicate of it. This means that bindings in the snapshot cannot be removed in the same way that they are in the original tree because the previous bindings for any key are not copied over to the snapshot.</p><p>This is used to produce snapshots of the referencing environment during a traversal of a Beluga signature at the point of declaration of Harpoon programs, so that we may revisit the referencing environment at those points later.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-size"><a href="#val-size" class="anchor"></a><code><span><span class="keyword">val</span> size : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="../../Support/Int/index.html#type-t">Support.Int.t</a></span></code></div><div class="spec-doc"><p><code>size tree</code> is the total number of key-value pairs in <code>tree</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_seq"><a href="#val-to_seq" class="anchor"></a><code><span><span class="keyword">val</span> to_seq : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Qualified_identifier/index.html#type-t">Qualified_identifier.t</a> * <span class="type-var">'a</span>)</span> <a href="../../Support/Seq/index.html#type-t">Support.Seq.t</a></span></span></code></div><div class="spec-doc"><p><code>to_seq tree</code> is the sequence of values mapped by qualified identifier in <code>tree</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span class="xref-unresolved">Stdlib</span>.Unit.t <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>create ()</code> is a new empty binding tree.</p></div></div></div></body></html>
